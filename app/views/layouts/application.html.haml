!!!
%html{lang: "en"}
  %head
    %meta{content: "text/html; charset=UTF-8", "http-equiv" => "Content-Type"}/
    %title 
      - if @page_title.present?
        = "GymTracker - #{@page_title}"
      - else
        GymTracker - Free Online Gym Tracker & Workout Log
    %meta{content: "width=device-width,initial-scale=1", name: "viewport"}/
    = csrf_meta_tags
    = csp_meta_tag
    = stylesheet_link_tag "application", "data-turbo-track": "reload"
    = javascript_importmap_tags
    = javascript_include_tag "turbo", type: "module"
    = favicon_link_tag 'favicon.ico'
    %link{href: image_path("apple-touch-icon.png"), rel: "apple-touch-icon"}
    - if @page_description.present?
      %meta{name: "description", content: @page_description}/
    
    %link{crossorigin: "use-credentials", href: "/manifest.json", rel: "manifest"}/
    = javascript_include_tag "//www.google.com/jsapi", "chartkick"

    / Google tag (gtag.js)
    %script{async: "", src: "https://www.googletagmanager.com/gtag/js?id=G-MWHGM094KQ"}
    :javascript
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-MWHGM094KQ');

      // Service Worker Update Check - Disabled
      // if ('serviceWorker' in navigator) {
      //   navigator.serviceWorker.register('/service-worker.js').then(registration => {
      //     registration.addEventListener('updatefound', () => {
      //       const newWorker = registration.installing;
      //       newWorker.addEventListener('statechange', () => {
      //         if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
      //           // New service worker is installed and ready to activate
      //           window.location.reload();
      //         }
      //       });
      //     });
      //   });
      // }

    %link{crossorigin: "anonymous", href: "https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css", integrity: "sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm", rel: "stylesheet"}/
    %script{crossorigin: "anonymous", integrity: "sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN", src: "https://code.jquery.com/jquery-3.2.1.slim.min.js"}
    %script{crossorigin: "anonymous", integrity: "sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q", src: "https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"}
    %script{crossorigin: "anonymous", integrity: "sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl", src: "https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"}
    
    // Font Awesome
    %script{crossorigin: "anonymous", src: "https://kit.fontawesome.com/d0da524149.js"}
    
    %link{href: image_path("splash_screens/iPhone_15_Pro_Max__iPhone_15_Plus__iPhone_14_Pro_Max_landscape.png"), media: "screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/iPhone_15_Pro__iPhone_15__iPhone_14_Pro_landscape.png"), media: "screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/iPhone_14_Plus__iPhone_13_Pro_Max__iPhone_12_Pro_Max_landscape.png"), media: "screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/iPhone_14__iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_landscape.png"), media: "screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_landscape.png"), media: "screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/iPhone_11_Pro_Max__iPhone_XS_Max_landscape.png"), media: "screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/iPhone_11__iPhone_XR_landscape.png"), media: "screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_landscape.png"), media: "screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: landscape)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_landscape.png"), media: "screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/4__iPhone_SE__iPod_touch_5th_generation_and_later_landscape.png"), media: "screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/12.9__iPad_Pro_landscape.png"), media: "screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/11__iPad_Pro__10.5__iPad_Pro_landscape.png"), media: "screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/10.9__iPad_Air_landscape.png"), media: "screen and (device-width: 820px) and (device-height: 1180px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/10.5__iPad_Air_landscape.png"), media: "screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/10.2__iPad_landscape.png"), media: "screen and (device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/9.7__iPad_Pro__7.9__iPad_mini__9.7__iPad_Air__9.7__iPad_landscape.png"), media: "screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/8.3__iPad_Mini_landscape.png"), media: "screen and (device-width: 744px) and (device-height: 1133px) and (-webkit-device-pixel-ratio: 2) and (orientation: landscape)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/iPhone_15_Pro_Max__iPhone_15_Plus__iPhone_14_Pro_Max_portrait.png"), media: "screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/iPhone_15_Pro__iPhone_15__iPhone_14_Pro_portrait.png"), media: "screen and (device-width: 393px) and (device-height: 852px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/iPhone_14_Plus__iPhone_13_Pro_Max__iPhone_12_Pro_Max_portrait.png"), media: "screen and (device-width: 428px) and (device-height: 926px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/iPhone_14__iPhone_13_Pro__iPhone_13__iPhone_12_Pro__iPhone_12_portrait.png"), media: "screen and (device-width: 390px) and (device-height: 844px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/iPhone_13_mini__iPhone_12_mini__iPhone_11_Pro__iPhone_XS__iPhone_X_portrait.png"), media: "screen and (device-width: 375px) and (device-height: 812px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/iPhone_11_Pro_Max__iPhone_XS_Max_portrait.png"), media: "screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/iPhone_11__iPhone_XR_portrait.png"), media: "screen and (device-width: 414px) and (device-height: 896px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/iPhone_8_Plus__iPhone_7_Plus__iPhone_6s_Plus__iPhone_6_Plus_portrait.png"), media: "screen and (device-width: 414px) and (device-height: 736px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/iPhone_8__iPhone_7__iPhone_6s__iPhone_6__4.7__iPhone_SE_portrait.png"), media: "screen and (device-width: 375px) and (device-height: 667px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/4__iPhone_SE__iPod_touch_5th_generation_and_later_portrait.png"), media: "screen and (device-width: 320px) and (device-height: 568px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/12.9__iPad_Pro_portrait.png"), media: "screen and (device-width: 1024px) and (device-height: 1366px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/11__iPad_Pro__10.5__iPad_Pro_portrait.png"), media: "screen and (device-width: 834px) and (device-height: 1194px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/10.9__iPad_Air_portrait.png"), media: "screen and (device-width: 820px) and (device-height: 1180px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/10.5__iPad_Air_portrait.png"), media: "screen and (device-width: 834px) and (device-height: 1112px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/10.2__iPad_portrait.png"), media: "screen and (device-width: 810px) and (device-height: 1080px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/9.7__iPad_Pro__7.9__iPad_mini__9.7__iPad_Air__9.7__iPad_portrait.png"), media: "screen and (device-width: 768px) and (device-height: 1024px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)", rel: "apple-touch-startup-image"}/
    %link{href: image_path("splash_screens/8.3__iPad_Mini_portrait.png"), media: "screen and (device-width: 744px) and (device-height: 1133px) and (-webkit-device-pixel-ratio: 2) and (orientation: portrait)", rel: "apple-touch-startup-image"}/
    %link{rel: "manifest", href: "/manifest.json", crossorigin: "use-credentials"}
    %meta{name: "theme-color", content: "#F8F9FA"}
  
  - if @page_title != "Free Online Gym Tracker & Workout Diary"
    %header
      %nav.navbar.navbar-expand-lg.navbar-light.bg-white.border-bottom.fixed-top.d-none.d-md-block
        .container-fluid
          %a.navbar-brand{href: "/"} 
            %i{class: "fa-solid fa-dumbbell", style: "color: #009dff;"}
            GymTracker
          %button.navbar-toggler{"aria-controls" => "navbarSupportedContent", "aria-expanded" => "false", "aria-label" => "Toggle navigation", "data-target" => "#navbarSupportedContent", "data-toggle" => "collapse", type: "button"}
            %span.navbar-toggler-icon
          #navbarSupportedContent.collapse.navbar-collapse
            %ul.navbar-nav.mr-auto
              %li.nav-item
                %a.nav-link{href: "/dashboard"} Dashboard
              %li.nav-item
                %a.nav-link{href: "/exercises"} Exercises
              %li.nav-item
                %a.nav-link{href: "/feed"} Feed
              %li.nav-item
                %a.nav-link{href: "/friend/list"} Friends
              
            %form.form-inline.ml-auto{style: "position: relative;"}
              - if user_signed_in?
                .btn-group
                  %a.btn.btn-info{href: "/users/view?id="+current_user.id.to_s}
                    %i.fa-solid.fa-user
                    %strong.ml-1
                      = current_user.first_name 

                  %button.btn.btn-info.dropdown-toggle.dropdown-toggle-split{"aria-expanded" => "false", "aria-haspopup" => "true", "data-toggle" => "dropdown", role: "button"}
                    %span.sr-only Toggle Dropdown
                  .dropdown-menu{style: "position: absolute; right: 0; left: auto; z-index: 1050;"}
                    %a.dropdown-item{href: "/users/view?id="+current_user.id.to_s} My Profile
                    %a.dropdown-item{href: "/users/edit"} Edit my Details
                    .dropdown-divider
                    = link_to "Logout", destroy_user_session_path, method: :delete, class: "dropdown-item text-danger"
     
  
  %body.bg-light
    - if @page_title != "Free Online Gym Tracker & Workout Diary"
      .d-none.d-md-block{style: "height: 56px;"}
      .container-fluid.mt-2.px-0
        - if notice
          %p.notice.alert.alert-success.alert-dismissible.fade.show.mb-0{role: "alert"}
            %strong Success!
            = notice
            %button.close{"aria-label" => "Close", "data-dismiss" => "alert", type: "button"}
              %span{"aria-hidden" => "true"} ×
        - if alert
          %p.alert.alert-danger.alert-dismissible.fade.show.mb-0{role: "alert"}
            %strong Error!
            = alert
            %button.close{"aria-label" => "Close", "data-dismiss" => "alert", type: "button"}
              %span{"aria-hidden" => "true"} ×
        // If the user is in the middle of a workout and is not already on /allset/(that page), show a warning
        - if user_signed_in?
          - if current_user.sets.count > 0
            - if current_page?("/allset/#{current_user.last_exercise.id}") == false && current_user.midworkout
              %p.alert.alert-warning.alert-dismissible.fade.show{role: "alert"}
                %strong Keep going!
                You are currently in the middle of a workout.
                %a{href: "/allset/#{current_user.last_exercise.id.to_s}"} 
                  = "Resume #{current_user.last_exercise.name}"
                %button.close{"aria-label" => "Close", "data-dismiss" => "alert", type: "button"}
                  %span{"aria-hidden" => "true"} ×

    = yield

- if @page_title != "Free Online Gym Tracker & Workout Diary"
  %footer.text-center.bg-light.pt-3.pb-2.border-top.mt-3
    %p
      %strong GymTracker,
      made by Ben Tindal

- if !@block_mobile_nav_bar.present?
  .d-block.d-md-none
    = render 'layouts/mobilenav'